import{d as te,u as z,b as H,r as k,e as se,c as p,f as t,t as w,F as V,g as T,w as q,h,i as $,m as ae,_ as B,j as le,o as u,k as L,l as j,n as U,p as oe,q as re,s as G,v as ne,x as C,y as ie,z as A,A as de,B as M,C as I,D as ue,E as ce,G as O}from"./index-Bg7ebdBG.js";const pe=te("history",()=>{const f={key:z("gpt-apiKey-history",[]),script:z("gpt-script-history",[]),docs:z("gpt-documents-history",[]),result:z("gpt-result-history",[])};(()=>{const l=Date.now();for(const s of["key","script","docs","result"])f[s].value.forEach(d=>{(!d.timestamp||isNaN(new Date(d.timestamp).getTime()))&&(d.timestamp=l)})})();const o=(l,s)=>{const d=f[l],i=d.value.find(S=>S.value===s);i?i.timestamp=Date.now():d.value.push({value:s,timestamp:Date.now()})};return{...f,update:o,remove:(l,s)=>{f[l].value.splice(s,1)},latest:l=>{var s;return((s=f[l].value.at(-1))==null?void 0:s.value)??null},apply:(l,s,d)=>{switch(l){case"key":d.apiKey.value=s;break;case"script":d.script.value=s;break;case"docs":try{const i=JSON.parse(s);Array.isArray(i)&&(d.documents.value=i,d.documentCount.value=i.length)}catch(i){console.warn("문서 파싱 실패:",i)}break;case"result":d.result.value=s;break}},saveAll:l=>{o("key",l.apiKey.value),o("script",l.script.value),o("docs",JSON.stringify(l.documents.value)),o("result",l.result.value)}}}),ve={class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},me={class:"flex justify-between items-center mb-2"},ye={class:"font-semibold text-lg dark:text-white"},ge={class:"space-y-2 text-sm"},be={class:"absolute top-2 right-2 flex space-x-1"},he=["onClick"],fe=["onClick"],ke=["onClick"],we={class:"text-xs text-gray-500 mt-1"},_e=H({__name:"HistoryModal",props:{title:{},entries:{},onApply:{type:Function},onDelete:{type:Function},onClose:{type:Function}},setup(f){const c=f,o=k(null);se(o,()=>c.onClose());function g(m){navigator.clipboard.writeText(m)}return(m,y)=>(u(),p("div",ve,[t("div",{ref_key:"modalRef",ref:o,class:"bg-white dark:bg-gray-800 p-4 rounded max-w-2xl w-full max-h-[80vh] overflow-auto"},[t("div",me,[t("h2",ye,w(m.title),1),t("button",{onClick:y[0]||(y[0]=(...n)=>c.onClose&&c.onClose(...n)),class:"text-sm px-2 py-1 rounded bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-white"}," 닫기 ")]),t("ul",ge,[(u(!0),p(V,null,T(c.entries,(n,l)=>(u(),p("li",{key:l,class:"relative bg-gray-100 dark:bg-gray-700 rounded p-2"},[t("div",be,[t("button",{onClick:q(s=>g(n.value),["stop"]),class:"p-1 border rounded bg-white dark:bg-gray-600 hover:bg-gray-100 dark:hover:bg-gray-500",title:"복사"},[h(B,{class:"w-4 h-4",path:$(ae)},null,8,["path"])],8,he),t("button",{onClick:q(s=>c.onDelete(l),["stop"]),class:"p-1 border rounded bg-white dark:bg-gray-600 hover:bg-gray-100 dark:hover:bg-gray-500",title:"삭제"},[h(B,{class:"w-4 h-4",path:$(le)},null,8,["path"])],8,fe)]),t("div",{class:"whitespace-pre-wrap break-all dark:text-white cursor-pointer pr-14",onClick:s=>c.onApply(n),title:"클릭하여 불러오기"},w(n.value),9,ke),t("div",we,w(new Date(n.timestamp).toLocaleString()),1)]))),128))])],512)]))}}),xe={key:0,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center"},Ce={class:"bg-white dark:bg-gray-800 p-6 rounded shadow max-w-md w-full"},$e={class:"flex justify-end mt-4 gap-2"},Se=H({__name:"ConfirmModal",props:{show:{type:Boolean},onCancel:{type:Function},onConfirm:{type:Function}},setup(f){return(c,o)=>c.show?(u(),p("div",xe,[t("div",Ce,[o[2]||(o[2]=t("h2",{class:"text-lg font-semibold mb-2 dark:text-white"},"⚠️ 저장 확인",-1)),o[3]||(o[3]=t("p",{class:"text-sm dark:text-gray-300"},[j(" 로컬스토리지에 히스토리를 저장합니다."),t("br")],-1)),t("div",$e,[t("button",{class:"px-3 py-1 text-sm border rounded dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700",onClick:o[0]||(o[0]=(...g)=>c.onCancel&&c.onCancel(...g))}," 취소 "),t("button",{class:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",onClick:o[1]||(o[1]=(...g)=>c.onConfirm&&c.onConfirm(...g))}," 확인 ")])])])):L("",!0)}}),Ae=["disabled"],De="rounded transition font-medium",D=H({__name:"BaseButton",props:{variant:{},size:{},disabled:{type:Boolean}},emits:["click"],setup(f,{emit:c}){const o=f,g=c,m=U(()=>o.size==="md"?"text-sm px-4 py-2":"text-xs px-2 py-1"),y=U(()=>({primary:"bg-blue-600 text-white hover:bg-blue-700",secondary:"bg-gray-200 dark:bg-gray-700 dark:text-white hover:bg-gray-300 dark:hover:bg-gray-600",danger:"bg-red-500 text-white hover:bg-red-600"})[o.variant??"secondary"]);let n=!1;function l(s){n||o.disabled||(n=!0,requestAnimationFrame(()=>n=!1),g("click",s))}return(s,d)=>(u(),p("button",{class:oe([De,m.value,y.value,{"cursor-not-allowed opacity-50":s.disabled}]),disabled:s.disabled,onClick:l},[re(s.$slots,"default")],10,Ae))}}),Ve={class:"max-w-6xl mx-auto p-4 space-y-6"},Te={class:"flex justify-between items-center mb-1"},je={class:"font-medium dark:text-white"},ze={class:"flex gap-2"},Ne={key:0},Be={key:1},Fe={key:2},Me={class:"mb-2"},Oe=["value"],Ue={class:"flex justify-between items-center"},He={class:"dark:text-white"},Ee=["onUpdate:modelValue"],Ke={class:"flex items-center gap-4 my-4"},Le={key:0},Pe={key:1},Je={class:"flex items-center gap-2"},Re=["value"],qe={class:"flex items-center gap-2"},Ge=["value"],Ie={class:"flex items-center gap-2"},Ye={class:"flex justify-between items-center mb-1"},Qe={class:"flex gap-2"},Xe=H({__name:"GptView",setup(f){const c=["gpt-3.5-turbo","gpt-4","gpt-4o"],o=z("gpt-model","gpt-3.5-turbo"),g=k(.7),m=z("gpt-persist",!1),y=k(""),n=k(""),l=k(2),s=k([]),d=k(!1),i=k(""),S=k(!1),E=k(!1),x=k(null),b=pe(),Y=["key","script","docs"],Q={key:"OPENAPI KEY",script:"Script",docs:"문서",result:"결과"},N=U(()=>({key:b.key.length,script:b.script.length,docs:b.docs.length,result:b.result.length})),W=U(()=>x.value?b[x.value]:[]);G(l,r=>{for(;s.value.length<r;)s.value.push("");for(;s.value.length>r;)s.value.pop()}),G(m,(r,e)=>{r&&!e&&(S.value=!0)});function P(){return s.value.map((r,e)=>`-- 문서 ${e+1} --
${r}`).join(`

`)}async function X(){var e,a,v;d.value=!0,i.value="";const r=`${n.value}

${P()}`;try{const F=await(await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${y.value.trim()}`,"Content-Type":"application/json"},body:JSON.stringify({model:o.value,messages:[{role:"user",content:r}],temperature:g.value})})).json();i.value=((v=(a=(e=F.choices)==null?void 0:e[0])==null?void 0:a.message)==null?void 0:v.content)||"[응답 없음]"}catch(_){i.value=`[에러 발생: ${_ instanceof Error?_.message:String(_)}]`}finally{d.value=!1,m.value&&b.saveAll({apiKey:y,script:n,documents:s,result:i})}}function J(r){N.value[r]>0&&(x.value=r,E.value=!0)}function R(){x.value=null,E.value=!1}function Z(r,e){b.apply(e,r,{apiKey:y,script:n,documents:s,documentCount:l,result:i}),R()}function ee(r,e){b.remove(e,r)}async function K(r){try{await navigator.clipboard.writeText(r)}catch(e){console.error("복사 실패:",e)}}return ne(()=>{if(m.value){y.value=b.latest("key")??"",n.value=b.latest("script")??"",i.value=b.latest("result")??"";const r=b.latest("docs");if(r)try{const e=JSON.parse(r);Array.isArray(e)&&(s.value=e,l.value=e.length)}catch(e){console.warn("문서 불러오기 실패:",e)}}for(;s.value.length<l.value;)s.value.push("");for(;s.value.length>l.value;)s.value.pop()}),(r,e)=>(u(),p("div",Ve,[(u(),p(V,null,T(Y,a=>t("div",{key:a},[t("div",Te,[t("label",je,w(Q[a]),1),t("div",ze,[h(D,{disabled:N.value[a]===0,onClick:v=>J(a)},{default:A(()=>[j(" 히스토리 ("+w(N.value[a])+") ",1)]),_:2},1032,["disabled","onClick"]),h(D,{onClick:v=>K(a==="key"?y.value:a==="script"?n.value:a==="docs"?P():i.value)},{default:A(()=>e[9]||(e[9]=[j(" 복사 ")])),_:2,__:[9]},1032,["onClick"])])]),a==="key"?(u(),p("div",Ne,[C(t("input",{"onUpdate:modelValue":e[0]||(e[0]=v=>y.value=v),class:"border rounded px-2 py-1 w-full dark:bg-gray-800 dark:border-gray-600 dark:text-white",placeholder:"sk-..."},null,512),[[O,y.value]])])):a==="script"?(u(),p("div",Be,[C(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=v=>n.value=v),class:"border rounded w-full h-24 p-2 dark:bg-gray-800 dark:border-gray-600 dark:text-white",placeholder:"스크립트를 입력하세요..."},null,512),[[O,n.value]])])):a==="docs"?(u(),p("div",Fe,[t("div",Me,[e[10]||(e[10]=t("label",{class:"font-medium dark:text-white"},"문서 수:",-1)),C(t("select",{"onUpdate:modelValue":e[2]||(e[2]=v=>l.value=v),class:"border rounded p-1 ml-2 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},[(u(),p(V,null,T(10,v=>t("option",{key:v,value:v},w(v),9,Oe)),64))],512),[[M,l.value]])]),(u(!0),p(V,null,T(s.value,(v,_)=>(u(),p("div",{key:_,class:"mb-2"},[t("div",Ue,[t("label",He,"문서 "+w(_+1),1),h(D,{onClick:F=>K(v)},{default:A(()=>e[11]||(e[11]=[j("복사")])),_:2,__:[11]},1032,["onClick"])]),C(t("textarea",{"onUpdate:modelValue":F=>s.value[_]=F,class:"border rounded w-full h-24 p-2 mt-1 dark:bg-gray-800 dark:border-gray-600 dark:text-white",placeholder:"문서 내용을 입력하세요..."},null,8,Ee),[[O,s.value[_]]])]))),128))])):L("",!0)])),64)),t("div",Ke,[h(D,{size:"md",variant:"primary",onClick:X,disabled:d.value},{default:A(()=>[d.value?(u(),p("span",Le,"실행 중...")):(u(),p("span",Pe,"실행"))]),_:1},8,["disabled"]),t("div",Je,[h(B,{path:$(de),class:"w-5 h-5"},null,8,["path"]),C(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>I(o)?o.value=a:null),class:"border rounded p-1 dark:bg-gray-800 dark:border-gray-600 dark:text-white w-full max-w-xs"},[(u(),p(V,null,T(c,a=>t("option",{key:a,value:a},w(a),9,Re)),64))],512),[[M,$(o)]])]),t("div",qe,[h(B,{path:$(ue),class:"w-5 h-5"},null,8,["path"]),C(t("select",{id:"temperature","onUpdate:modelValue":e[4]||(e[4]=a=>g.value=a),class:"border rounded p-1 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},[(u(),p(V,null,T(11,a=>t("option",{key:a,value:(a-1)/10},w(((a-1)/10).toFixed(1)),9,Ge)),64))],512),[[M,g.value,void 0,{number:!0}]])]),t("div",Ie,[h(B,{path:$(ce),class:"w-5 h-5"},null,8,["path"]),C(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>I(m)?m.value=a:null),class:"border rounded p-1 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},e[12]||(e[12]=[t("option",{value:!1},"저장 안함",-1),t("option",{value:!0},"저장함",-1)]),512),[[M,$(m)]])])]),t("div",Ye,[e[14]||(e[14]=t("label",{class:"font-medium dark:text-white"},"결과",-1)),t("div",Qe,[h(D,{disabled:N.value.result===0,onClick:e[6]||(e[6]=a=>J("result"))},{default:A(()=>[j(" 히스토리 ("+w(N.value.result)+") ",1)]),_:1},8,["disabled"]),h(D,{onClick:e[7]||(e[7]=a=>K(i.value))},{default:A(()=>e[13]||(e[13]=[j("복사")])),_:1,__:[13]})])]),C(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=a=>i.value=a),class:"border rounded w-full h-48 p-2 dark:bg-gray-800 dark:border-gray-600 dark:text-white",readonly:"",placeholder:"결과가 여기에 표시됩니다..."},null,512),[[O,i.value]]),E.value&&x.value?(u(),ie(_e,{key:0,title:{key:"🔑 API Key",script:"📜 Script",docs:"📄 문서",result:"📊 결과"}[x.value],entries:W.value,onApply:a=>Z(a.value,x.value),onDelete:a=>ee(a,x.value),onClose:R},null,8,["title","entries","onApply","onDelete"])):L("",!0),h(Se,{show:S.value,onCancel:()=>{m.value=!1,S.value=!1},onConfirm:()=>{S.value=!1}},null,8,["show","onCancel","onConfirm"])]))}});export{Xe as default};
